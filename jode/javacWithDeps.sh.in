#!/bin/sh
JAVAC=@JAVAC@
JIKES=@JIKES@
PERL=@PERL@

abs_top_builddir=`cd $top_builddir; pwd`
abs_top_srcdir=`cd $top_srcdir; pwd`
if [ "$JAVAC" = "$JIKES" -a -n "$PERL" ]; then
  TEMPDEPS=`mktemp "deps.XXXXXX"`
  trap "rm $TEMPDEPS" EXIT
  $JAVAC +M=$TEMPDEPS $*
  sort $TEMPDEPS | $PERL -ne 's"^(\Q'$top_srcdir'\E|\Q'$top_builddir'\E)"'$abs_top_builddir'"; s": \Q'$top_srcdir'\E": '$abs_top_srcdir'"; s": \Q'$top_builddir'\E": '$abs_top_builddir'"; m"(\Q'$abs_top_builddir'\E[^\.:]+)\.class: [^\.]*.java$" or next; if ($1 ne $last) { $last = $1; open DEP, ">$1.u" }; print DEP $_'
else
  $JAVAC $*
fi
